
#include <iostream>
#include <vector>

#define ALGEBRA_IMPL
#define ALGEBRA_SHORT_NAMES
#include "algbera.h"
#include "calibration.h"
#include "camera.h"

using namespace Algebra;
using namespace std::placeholders;


static double size = 1, sensor_pixel_size = 1.12e-6;
static int width = 5312, height = 2988;
static int layout_x = 7, layout_y = 5;
static std::vector<std::vector<Vec>> points = {
    {Vec({1447.6632,652.4185}),  Vec({1855.779,653.6937}),   Vec({2260.2432,653.9705}),  Vec({2661.6667,651.54346}), Vec({3064.6223,646.02716}), Vec({3471.6267,639.5849}),  Vec({3881.254,632.47833}),  Vec({1464.3779,1062.6641}), Vec({1868.8302,1063.05}), Vec({2267.5527,1061.9054}), Vec({2663.9385,1059.0275}), Vec({3060.6692,1055.5146}), Vec({3463.0896,1049.4722}), Vec({3869.5818,1043.6792}), Vec({1479.5461,1462.8992}), Vec({1879.4222,1460.6489}), Vec({2273.8083,1458.2185}), Vec({2666.064,1455.7513}), Vec({3058.276,1452.1133}), Vec({3456.0764,1449.0414}), Vec({3859.107,1445.2458}), Vec({1490.8859,1855.3342}), Vec({1888.0289,1850.9668}), Vec({2279.3936,1847.3595}), Vec({2668.0698,1844.0776}), Vec({3057.708,1842.0598}), Vec({3452.0283,1840.2754}), Vec({3851.1074,1839.253}), Vec({1500.0402,2243.298}), Vec({1894.5195,2236.4607}), Vec({2283.9185,2231.2527}), Vec({2670.608,2227.747}), Vec({3058.3245,2226.5789}), Vec({3449.8108,2226.9683}), Vec({3845.4277,2227.5166})},
    {Vec({517.5,935.0}),         Vec({952.3259,960.80835}),  Vec({1353.4779,988.25745}), Vec({1720.868,1013.289}),   Vec({2056.7158,1036.1849}), Vec({2364.4983,1056.2407}), Vec({2649.7966,1073.4001}), Vec({519.0,1339.0}), Vec({951.9582,1345.7369}), Vec({1353.3053,1357.2115}), Vec({1719.8691,1365.8746}), Vec({2053.3228,1373.4413}), Vec({2359.5503,1379.8296}), Vec({2642.948,1385.9207}), Vec({520.8562,1736.2976}), Vec({953.15674,1729.3018}), Vec({1351.6271,1721.7445}), Vec({1716.6978,1713.2767}), Vec({2048.6711,1706.4999}), Vec({2353.8354,1700.0667}), Vec({2636.5544,1694.7336}), Vec({522.5,2134.5}), Vec({950.0,2109.5}), Vec({1347.4999,2083.166}), Vec({1711.517,2059.093}), Vec({2043.4258,2037.552}), Vec({2347.6533,2018.3014}), Vec({2629.5972,2001.8385}), Vec({525.50006,2525.9368}), Vec({949.1145,2486.271}), Vec({1343.0144,2444.0735}), Vec({1705.2065,2404.4453}), Vec({2036.6317,2368.421}), Vec({2341.5706,2336.5312}), Vec({2623.3325,2308.1328})},
    {Vec({2148.0916,879.2464}),  Vec({2476.483,860.26807}),  Vec({2824.0078,837.79663}), Vec({3196.0,813.0}),        Vec({3594.5,784.5}),        Vec({4023.0,754.0}),        Vec({4480.0,724.0}),        Vec({2162.8083,1234.5663}), Vec({2488.2415,1224.3367}), Vec({2831.8015,1213.9867}), Vec({3199.5833,1201.5311}), Vec({3592.002,1188.2374}), Vec({4020.0,1171.5}), Vec({4472.9927,1157.5973}), Vec({2176.5352,1580.5315}), Vec({2499.8037,1580.784}), Vec({2841.0986,1580.2937}), Vec({3204.5566,1580.6044}), Vec({3594.8335,1580.3271}), Vec({4018.4553,1580.2104}), Vec({4469.4556,1580.5819}), Vec({2189.24,1923.2104}), Vec({2510.081,1931.8861}), Vec({2850.3513,1942.4669}), Vec({3211.447,1953.6062}), Vec({3600.046,1968.098}), Vec({4019.588,1982.677}), Vec({4466.475,1998.2012}), Vec({2200.541,2263.3433}), Vec({2520.7988,2281.3823}), Vec({2859.5999,2301.3213}), Vec({3220.7454,2325.2927}), Vec({3607.4387,2351.7654}), Vec({4023.3381,2380.8245}), Vec({4463.568,2407.9307})},
    {Vec({2267.3486,501.52032}), Vec({2601.579,512.0435}),   Vec({2949.8335,519.6726}),  Vec({3314.0754,526.3494}),  Vec({3696.3484,532.50415}), Vec({4094.984,541.01184}),  Vec({4507.657,552.4436}),   Vec({2278.767,848.9458}), Vec({2602.008,864.076}), Vec({2936.6255,879.26215}), Vec({3287.4907,893.0994}), Vec({3656.5146,907.1811}), Vec({4043.4426,921.5486}), Vec({4444.1743,939.41534}), Vec({2289.0361,1170.9359}), Vec({2601.5605,1191.7053}), Vec({2925.8076,1211.945}), Vec({3263.7056,1233.4333}), Vec({3620.1577,1254.4513}), Vec({3994.4976,1277.2743}), Vec({4383.3467,1301.2339}), Vec({2298.346,1473.4574}), Vec({2601.2136,1497.6573}), Vec({2915.7317,1524.3895}), Vec({3243.7744,1550.9318}), Vec({3587.7356,1579.4844}), Vec({3950.2,1609.2067}), Vec({4326.876,1639.8906}), Vec({2306.5862,1758.3337}), Vec({2601.558,1787.6313}), Vec({2906.9106,1817.2616}), Vec({3225.3342,1850.2877}), Vec({3559.5242,1883.7618}), Vec({3909.9592,1920.2585}), Vec({4273.6963,1957.3223})},
    {Vec({653.0,627.5}),         Vec({1071.0,639.5}),        Vec({1462.959,654.88477}),  Vec({1823.9983,669.3163}),  Vec({2159.543,681.5778}),   Vec({2469.6497,691.9491}),  Vec({2760.272,699.5764}),   Vec({682.5,1012.5}), Vec({1087.5,1010.5}), Vec({1467.2025,1011.54987}), Vec({1817.5365,1012.1715}), Vec({2140.9727,1012.4046}), Vec({2441.9387,1011.5769}), Vec({2723.6726,1009.71967}), Vec({706.6491,1369.8121}), Vec({1104.0856,1355.6582}), Vec({1470.7479,1344.1996}), Vec({1809.63,1332.222}), Vec({2123.2417,1321.0902}), Vec({2415.498,1310.1544}), Vec({2689.216,1299.1498}), Vec({732.5795,1707.96}), Vec({1116.1271,1680.0656}), Vec({1471.4089,1654.6464}), Vec({1801.0315,1632.0446}), Vec({2106.1099,1610.6213}), Vec({2390.1226,1590.5137}), Vec({2657.5,1573.0}), Vec({756.5,2020.5}), Vec({1123.0356,1984.2482}), Vec({1470.9807,1948.3533}), Vec({1791.4796,1914.9584}), Vec({2088.5078,1884.195}), Vec({2366.8066,1856.6226}), Vec({2627.1553,1830.9043})},
    {Vec({1643.3267,610.52246}), Vec({1992.3859,615.26935}), Vec({2339.1716,619.42114}), Vec({2683.7305,621.1982}),  Vec({3028.9492,620.6974}),  Vec({3376.4438,619.6484}),  Vec({3726.5354,616.9469}),  Vec({1612.501,910.454}), Vec({1973.4331,916.67346}), Vec({2330.0603,919.7521}), Vec({2684.8098,921.2707}), Vec({3039.7397,921.9379}), Vec({3398.4424,920.54584}), Vec({3760.2578,918.63525}), Vec({1578.7035,1230.4514}), Vec({1952.0189,1234.0334}), Vec({2320.4312,1237.2756}), Vec({2685.7651,1239.0144}), Vec({3052.1863,1238.9408}), Vec({3422.0664,1239.5789}), Vec({3796.8389,1238.9928}), Vec({1540.5781,1571.4427}), Vec({1927.7131,1573.7181}), Vec({2308.9219,1575.0308}), Vec({2686.7483,1576.4598}), Vec({3065.563,1578.7148}), Vec({3448.9846,1579.5826}), Vec({3837.3362,1581.6082}), Vec({1497.6715,1938.5983}), Vec({1900.0507,1937.8732}), Vec({2295.701,1938.2294}), Vec({2689.264,1939.3522}), Vec({3082.0818,1942.0643}), Vec({3480.2048,1945.6782}), Vec({3882.9414,1949.2864})},
    {Vec({1492.9849,893.0098}),  Vec({1863.8544,901.1292}),  Vec({2228.626,907.6775}),   Vec({2586.5596,913.1616}),  Vec({2942.8213,916.0796}),  Vec({3298.3352,918.71027}), Vec({3655.5137,919.3756}),  Vec({1523.8474,1243.7654}), Vec({1882.6993,1248.5027}), Vec({2233.7527,1252.2767}), Vec({2579.914,1255.0486}), Vec({2923.6096,1258.1886}), Vec({3267.3096,1259.865}), Vec({3612.3748,1261.6499}), Vec({1550.6909,1569.226}), Vec({1898.1613,1572.2391}), Vec({2237.9841,1573.9983}), Vec({2573.2478,1575.654}), Vec({2906.4307,1577.0311}), Vec({3238.8105,1578.9474}), Vec({3573.1167,1580.7388}), Vec({1574.7703,1878.1948}), Vec({1911.0554,1876.7805}), Vec({2241.4226,1876.286}), Vec({2566.6663,1876.5955}), Vec({2890.228,1878.1984}), Vec({3213.2688,1879.385}), Vec({3537.914,1881.6525}), Vec({1595.4395,2169.32}), Vec({1922.4526,2165.586}), Vec({2243.93,2163.2192}), Vec({2561.1958,2161.708}), Vec({2875.8875,2162.284}), Vec({3190.3853,2163.9648}), Vec({3505.8691,2165.9001})},
    {Vec({2592.8984,926.7849}),  Vec({2827.941,896.0024}),   Vec({3085.5872,860.27826}), Vec({3370.4136,821.29504}), Vec({3687.6492,776.51953}), Vec({4040.188,728.4584}),   Vec({4430.459,676.78894}),  Vec({2595.6487,1210.311}), Vec({2829.4763,1191.5374}), Vec({3086.1338,1171.5045}), Vec({3369.7573,1147.5476}), Vec({3686.5945,1121.4299}), Vec({4039.8987,1091.9359}), Vec({4432.3086,1060.7366}), Vec({2598.1433,1490.6445}), Vec({2831.5498,1485.6505}), Vec({3088.5,1478.7373}), Vec({3369.9297,1471.7289}), Vec({3686.6338,1462.7498}), Vec({4040.7573,1454.1433}), Vec({4434.4814,1444.3029}), Vec({2600.4563,1771.3242}), Vec({2835.0696,1777.9448}), Vec({3090.4343,1785.7148}), Vec({3374.6592,1794.4032}), Vec({3690.0999,1803.409}), Vec({4042.5308,1814.5946}), Vec({4437.2666,1826.1063}), Vec({2603.543,2051.3523}), Vec({2837.5496,2070.673}), Vec({3094.0825,2092.2354}), Vec({3377.8008,2117.5056}), Vec({3694.617,2144.0261}), Vec({4048.2905,2176.2817}), Vec({4440.4297,2208.0364})},
    {Vec({391.72955,772.5915}),  Vec({692.3987,760.1828}),   Vec({1005.9653,746.49384}), Vec({1332.0732,734.3265}),  Vec({1668.3597,723.9059}),  Vec({2013.0369,712.7255}),  Vec({2366.4822,699.7475}),  Vec({391.3061,1112.4678}), Vec({692.9277,1104.0728}), Vec({1007.4017,1096.3835}), Vec({1335.3064,1090.2109}), Vec({1672.1143,1084.4639}), Vec({2017.079,1077.8525}), Vec({2368.1855,1070.5308}), Vec({391.6167,1451.3008}), Vec({693.2751,1448.5477}), Vec({1008.94165,1446.818}), Vec({1337.6116,1444.1857}), Vec({1675.5042,1441.8905}), Vec({2018.6368,1440.1841}), Vec({2369.7502,1437.1976}), Vec({390.26508,1790.8647}), Vec({693.6477,1793.4462}), Vec({1009.97375,1796.2478}), Vec({1338.4789,1797.5643}), Vec({1676.4084,1798.9711}), Vec({2020.3525,1800.6768}), Vec({2370.8174,1803.448}), Vec({391.77618,2129.5776}), Vec({694.48334,2137.9993}), Vec({1009.4914,2145.7769}), Vec({1337.2283,2152.5105}), Vec({1674.4664,2157.6436}), Vec({2019.9639,2163.555}), Vec({2371.5352,2170.4617})},
    {Vec({672.24866,672.0428}),  Vec({1076.0,710.5}),        Vec({1439.5818,747.56494}), Vec({1760.6849,781.92096}), Vec({2051.974,811.8042}),   Vec({2312.012,837.9621}),   Vec({2549.3179,860.83514}), Vec({679.5,1068.5}), Vec({1081.0,1086.5}), Vec({1441.0,1101.0}), Vec({1763.8546,1116.6719}), Vec({2050.6497,1129.126}), Vec({2309.1606,1140.0269}), Vec({2543.7642,1149.1569}), Vec({686.2511,1461.2339}), Vec({1085.5137,1454.9293}), Vec({1445.3401,1450.0736}), Vec({1763.9265,1444.2859}), Vec({2048.3647,1440.4735}), Vec({2304.5273,1436.5563}), Vec({2538.5056,1432.5309}), Vec({693.0,1847.5}), Vec({1088.4738,1818.8412}), Vec({1444.11,1792.41}), Vec({1761.4308,1768.6797}), Vec({2045.4962,1747.5656}), Vec({2300.4795,1729.0266}), Vec({2532.9514,1713.0629}), Vec({697.5,2229.0}), Vec({1090.1661,2177.7227}), Vec({1443.4012,2132.515}), Vec({1758.7885,2089.4075}), Vec({2040.8118,2052.4807}), Vec({2295.687,2020.0275}), Vec({2527.5232,1990.4308})},
    {Vec({2521.061,757.37744}),  Vec({2882.1216,770.4984}),  Vec({3232.0564,779.9663}),  Vec({3570.3523,789.40875}), Vec({3899.498,796.94446}),  Vec({4215.631,807.2652}),   Vec({4514.6777,817.84326}), Vec({2519.1873,1139.6821}), Vec({2877.9827,1143.0249}), Vec({3223.5386,1147.4141}), Vec({3560.1677,1149.0765}), Vec({3885.1257,1151.7323}), Vec({4201.7007,1154.8739}), Vec({4502.5664,1156.8029}), Vec({2517.961,1511.4163}), Vec({2873.5142,1509.5099}), Vec({3217.267,1505.1577}), Vec({3550.587,1503.3713}), Vec({3875.2764,1499.943}), Vec({4189.843,1497.1439}), Vec({4489.731,1495.829}), Vec({2517.4944,1881.1243}), Vec({2870.6897,1869.058}), Vec({3212.4607,1860.6355}), Vec({3544.3975,1851.8429}), Vec({3867.4033,1843.5945}), Vec({4178.4824,1836.1581}), Vec({4478.233,1828.4125}), Vec({2515.9185,2244.216}), Vec({2868.634,2227.8796}), Vec({3209.1006,2210.632}), Vec({3539.4995,2198.5515}), Vec({3859.639,2184.3623}), Vec({4169.738,2170.7007}), Vec({4466.3027,2156.2847})}
};
        }
    }
}
 */
int main()
{
    Timer t("calibration");
    MoCap::Camera cam(width, height, sensor_pixel_size);
    double avgReprojErr = cam.calibrateIntrinsics(layout_x, layout_y, size, points);
    std::cout << "Average Reprojection Error: " << avgReprojErr << '\n';
    cam.print();
}